<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Huge File Reader</title>
</head>
<body>
    
    <script>

(function() {

var count = 0

function parseFile(file, options) {
    var fileSize = file.size
    var chunkSize = 1024 * 1024
    var binary = true
    var offset = 0
    var readBlock = null
    var chunkReadCallback = function(data) {
        // send data to server
    }
    var chunkErrorCallback = function(err) {
        console.log('ERROR', err)
    }
    var success = function(count) {
        console.log('Yes :)))) ' + count)
    }
    var onLoadHandler = function(evt) {
        if (evt.target.error == null) {
            offset += evt.loaded
            count = offset
            chunkReadCallback(evt.target.result)
        } else {
            chunkErrorCallback(evt.target.error)
            return
        }
        if (offset >= fileSize) {
            success(count)
            return
        }

        readBlock(offset, chunkSize, file)
    }

    readBlock = function(_offset, length, _file) {
        var r = new FileReader()
        var blob = _file.slice(_offset, length + _offset);
        r.onload = onLoadHandler
        if (binary) {
          r.readAsArrayBuffer(blob)
        } else {
          r.readAsText(blob)
        }
    }

    readBlock(offset, chunkSize, file)
}

window.ondragover = function() { return false }
window.ondrop = function(e) { 
    if (e.dataTransfer.files.length > 0) {
        parseFile(e.dataTransfer.files[0])
        console.log(e.dataTransfer.files[0])
    }
    return false 
}

})()

    </script>
</body>
</html>
